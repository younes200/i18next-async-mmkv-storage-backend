!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.i18nextMMKVStorageBackend=n()}(this,function(){"use strict";function e(e){return s.call(o.call(arguments,1),function(n){if(n)for(var i in n)void 0===e[i]&&(e[i]=n[i])}),e}function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(){return{prefix:"i18next_res_",expirationTime:6048e5,versions:{}}}var t=[],s=t.forEach,o=t.slice;const r={WHEN_UNLOCKED:"AccessibleWhenUnlocked",AFTER_FIRST_UNLOCK:"AccessibleAfterFirstUnlock",ALWAYS:"AccessibleAlways",WHEN_PASSCODE_SET_THIS_DEVICE_ONLY:"AccessibleWhenPasscodeSetThisDeviceOnly",WHEN_UNLOCKED_THIS_DEVICE_ONLY:"AccessibleWhenUnlockedThisDeviceOnly",AFTER_FIRST_UNLOCK_THIS_DEVICE_ONLY:"AccessibleAfterFirstUnlockThisDeviceOnly",ALWAYS_THIS_DEVICE_ONLY:"AccessibleAlwaysThisDeviceOnly"},c={SINGLE_PROCESS:1,MULTI_PROCESS:2},l=(Object.freeze({STRING:1,NUMBER:2,BOOL:3,MAP:4,ARRAY:5}),require("./src/loader").default),a={Loader:l,MODES:c,ACCESSIBLE:r};var u=function(){function e(e,n){for(var i=0;i<n.length;i++){var t=n[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,i,t){return i&&e(n.prototype,i),t&&e(n,t),n}}(),f=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,t),this.init(e,i),this.type="backend"}return u(t,[{key:"init",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.services=n,this.options=e(t,this.options||{},i()),t.instance?this.MMKV=t.instance:this.MMKV=(new a.Loader).initialize()}},{key:"read",value:function(e,n,i){var t=this,s=(new Date).getTime();if(!this.MMKV)return i(null,null);this.MMKV.getString(""+this.options.prefix+e+"-"+n).then(function(n){if(n&&(n=JSON.parse(n),n.i18nStamp&&n.i18nStamp+t.options.expirationTime>s&&t.options.versions[e]===n.i18nVersion))return delete n.i18nVersion,delete n.i18nStamp,i(null,n);i(null,null)}).catch(function(e){console.warn(e),i(null,null)})}},{key:"save",value:function(e,n,i){this.MMKV&&(i.i18nStamp=(new Date).getTime(),this.options.versions[e]&&(i.i18nVersion=this.options.versions[e]),this.MMKV.setString(""+this.options.prefix+e+"-"+n,JSON.stringify(i)))}}]),t}();return f.type="backend",f});
